import{E as H,o as c,l as I,y as K,J as P,G,I as X,K as B,a7 as V,a8 as L,L as Y,a9 as q,aa as Q,c as v,ab as U,ac as Z,ad as ee,H as te,a6 as $,ae as ie,b as ne,af as ae,p as J,M as F,N as r,a as g,v as se,t as S,a4 as N,x as D,n as oe,O as re}from"./index-CUz47RG4.js";import{s as de}from"./index-B0fGYRp0.js";import{u as le}from"./connection.store-DtiKPjw5.js";import"./index-PFMSMQwc.js";const pe=H({__name:"InternalAppComponent",props:{app:{},metadata:{},appReady:{type:Function},changeWindowTitle:{type:Function}},setup(x){return(n,p)=>(c(),I(K(n.app.component),{appReady:n.appReady,changeWindowTitle:n.changeWindowTitle,metadata:n.metadata},null,8,["appReady","changeWindowTitle","metadata"]))}}),ce=["src","frame-id","name"],ue=H({__name:"IframeAppComponent",props:{app:{},metadata:{},appReady:{type:Function},changeWindowTitle:{type:Function}},setup(x){const n=x,p=P(),w=G(),b=X(),l=le(),u=U("settings"),W=U("network"),i=B("iframe"),m=e=>{var a;i.value&&((a=i.value.contentWindow)==null||a.postMessage(e,"*"))},E=()=>{i.value&&m({action:`${n.app.id}:appData`,data:JSON.stringify(n.app)})},o=()=>{i.value&&m({action:`${n.app.id}:settings`,data:w.forApps})},R=()=>{i.value&&m({action:`${n.app.id}:network`,data:l.forApps})},k=()=>{i.value&&m({action:`${n.app.id}:devices`,data:JSON.stringify(p.installedDevices)})},z=e=>{i.value&&b.show(e)},M=()=>{var t,s;if(!i.value)return;const a=Object.entries({visibility:"visible",width:"100%",height:"100%",padding:0,margin:0}).map(([d,f])=>`${d}: ${f};`).join(" ");(t=i.value.contentDocument)==null||t.documentElement.setAttribute("style",a),(s=i.value.contentDocument)==null||s.body.setAttribute("style",a)},h=()=>{i.value&&(n.appReady(),M())},T=()=>{if(!i.value)return;const e={parentReady:()=>C(),appReady:()=>h(),changeWindowTitle:a=>n.changeWindowTitle(a),getAppData:()=>E(),getSettings:()=>o(),getNetworkSettings:()=>R(),getDevices:()=>k(),sendNotification:a=>z(a)};Z(i.value.contentWindow,"message",a=>{if(typeof a.data=="string")return e[a.data]?e[a.data](a.data):void 0;const{action:t,data:s}=a.data;e[t]&&e[t](s)})},_=()=>{var s;if(!i.value)return;const e=(s=i.value.contentWindow)==null?void 0:s.document.body;if(!e)return;(e==null?void 0:e.appendChild(document.createElement("script"))).appendChild(document.createTextNode(`
        globalThis.resourceName = '${n.app.resourceName}'
        globalThis.appId = '${n.app.id}'
    `));const t=e==null?void 0:e.appendChild(document.createElement("script"));t==null||t.setAttribute("src",`https://cfx-nui-${ee}/web/dist/global.js`)},O=()=>{i.value&&(T(),_())},C=()=>{n.app.ui.includes("rahe-")&&A(),n.app.ui.includes("kub_")&&y()},y=(e=!0)=>{var a,t,s,d;if((a=i.value.contentWindow)==null||a.postMessage({type:e?"showUI":"hideUI"},"*"),e){(s=((t=i.value.contentWindow)==null?void 0:t.document.body).firstElementChild)==null||s.setAttribute("style","position:relative; margin: 0; left: 0; top: 0; width: 100%; height: 100%; max-height: auto; max-width: auto; transform: none;");const j=((d=i.value.contentWindow)==null?void 0:d.document.head).appendChild(document.createElement("style"));j.setAttribute("type","text/css"),j.appendChild(document.createTextNode(".border-image { border-image: unset !important; } .ipad{border: unset !important;} .ipad::after{display:none !important;}"))}},A=(e=!0)=>{var a,t,s,d;if((a=i.value.contentWindow)==null||a.postMessage({action:e?"showMenu":"hideMenu"},"*"),e){const f=(t=i.value.contentWindow)==null?void 0:t.document.body;(s=f.firstElementChild)==null||s.setAttribute("style","position:relative; margin: 0; left: 0; top: 0; width: 100%; height: 100%;"),(d=f.getElementsByClassName("tablet-frame")[0])==null||d.remove()}};return V(async()=>{var e;u.on(a=>{var t;a==="updated"&&((t=i.value.contentWindow)==null||t.postMessage({action:"changedSettings",data:w.forApps},"*"))}),W.on(a=>{var t;a==="updated"&&((t=i.value.contentWindow)==null||t.postMessage({action:"networkChanged",data:l.forApps},"*"))}),(n.app.onUse||n.app.onUseServer)&&await L("appOpened",{method:"POST",body:JSON.stringify({id:n.app.id})},void 0,null),Y("Escape",()=>{p.isOpen&&p.close(!0)},{target:(e=i.value.contentWindow)==null?void 0:e.window})}),q("sendAppMessage",e=>{e.id===n.app.id&&m(e.message)}),Q(async()=>{n.app.ui.includes("rahe-")&&A(!1),n.app.ui.includes("kub-")&&y(!1),(n.app.onClose||n.app.onCloseServer)&&await L("appClosed",{method:"POST",body:JSON.stringify({id:n.app.id})},void 0,null)}),(e,a)=>(c(),v("iframe",{ref_key:"iframe",ref:i,src:e.app.ui,"frame-id":e.app.id,onload:O,name:e.app.id},null,8,ce))}}),me={class:"mr-5 flex h-full max-w-96 items-center truncate px-2"},fe={class:"flex h-full items-center"},ge={key:0,class:"flex flex-1 items-center justify-center overflow-hidden"},he={class:"relative flex flex-1 overflow-hidden"},We=H({__name:"Window",props:{appWindow:{},parent:{}},setup(x){const n=x,p=te(),w=B("window"),b=B("toolbar"),{app:l,app:{windowActions:u},metadata:W,dimensions:i,position:[m,E],state:o}=n.appWindow,{parent:R}=n,k=$(i.width),z=$(i.height),M=$(l.name),h=$(!0),{x:T,y:_}=ie(w,{initialValue:{x:m,y:E},containerElement:R,preventDefault:!0,handle:b,disabled:!u.isDraggable,onMove(){o.isMaximized&&(o.isMaximized=!1)}}),O=ne(()=>{const t={top:`${_.value}px`,left:`${T.value}px`,width:`${k.value}px`,minWidth:`${i.minWidth}px`,maxWidth:`${i.maxWidth}px`,height:`${z.value}px`,minHeight:`${i.minHeight}px`,maxHeight:`${i.maxHeight}px`,zIndex:20};return o.isMaximized&&(t.inset="0px",t.width="100%",t.height="100%",t.maxHeight="100%",t.maxWidth="100%"),!o.isMaximized&&u.isResizable&&(t.resize="both"),o.isActive&&(t.zIndex=40),t}),C=t=>{M.value=t},y=()=>{h.value=!1},A=()=>{p.toggleActiveState(l.id,!1),p.toggleMinimizeState(l.id,!0)},e=()=>{o.isMaximized=!o.isMaximized},a=()=>{p.close(l.id)};return V(async()=>{ae(w,t=>{const s=t[0],{width:d,height:f}=s.contentRect;o.isMaximized||o.isMinimized||(k.value=d,z.value=f)}),l.ignoreInternalLoading&&(h.value=!1)}),(t,s)=>J((c(),v("div",{ref:"window",onClick:s[3]||(s[3]=N(d=>r(p).toggleActiveState(r(l).id,!0),["prevent"])),class:S(["absolute flex flex-1 flex-col overflow-hidden rounded-t-lg bg-gray-100/70 shadow-md backdrop-blur-xl dark:bg-gray-800/70",{"z-[100]":!r(o).isActive,"z-[999]":r(o).isActive}]),style:re(O.value)},[g("div",{class:"toolbar flex h-8 select-none items-center justify-between bg-gray-100/50 dark:bg-gray-900/50",ref_key:"toolbar",ref:b},[g("div",me,se(M.value??"-"),1),g("div",fe,[r(u).isMinimizable?(c(),v("button",{key:0,class:S(["flex h-full w-12 items-center justify-center text-neutral-500",["hover:bg-white hover:bg-opacity-5 hover:text-white"]]),type:"button",onClick:s[0]||(s[0]=N(d=>A(),["prevent"]))},s[4]||(s[4]=[g("i",{class:"pi pi-minus text-xs"},null,-1)]))):D("",!0),r(u).isMaximizable?(c(),v("button",{key:1,class:S(["flex h-full w-12 items-center justify-center text-neutral-500",["hover:bg-white hover:bg-opacity-5 hover:text-white"]]),type:"button",onClick:s[1]||(s[1]=N(d=>e(),["prevent"]))},[g("i",{class:S(["pi text-xs",r(o).isMaximized?"pi-window-minimize":"pi-window-maximize"])},null,2)])):D("",!0),r(u).isClosable?(c(),v("button",{key:2,onClick:s[2]||(s[2]=N(d=>a(),["prevent"])),class:"flex h-full w-12 items-center justify-center text-neutral-500 hover:bg-red-600 hover:text-white",type:"button"},s[5]||(s[5]=[g("i",{class:"pi pi-times text-xs"},null,-1)]))):D("",!0)])],512),h.value?(c(),v("div",ge,[oe(r(de))])):D("",!0),J(g("div",he,[r(l).isInternal?(c(),I(pe,{key:0,app:r(l),metadata:r(W),appReady:y,changeWindowTitle:C,class:"flex flex-1 overflow-hidden"},null,8,["app","metadata"])):(c(),I(ue,{key:1,app:r(l),metadata:r(W),appReady:y,changeWindowTitle:C,class:"flex flex-1 overflow-hidden"},null,8,["app","metadata"]))],512),[[F,!h.value]])],6)),[[F,!r(o).isMinimized&&!n.appWindow.isHidden]])}});export{We as default};
